{"version":3,"file":"svg.topoly.node.js","sources":["../src/svg.topoly.js"],"sourcesContent":["import {\n  Path,\n  PathArray,\n  PointArray,\n  Polygon,\n  Polyline,\n  Number as SVGNumber,\n  extend,\n  parser\n} from '@svgdotjs/svg.js'\n\n// Normalise attributes\nconst normaliseAttributes = (attr) => {\r\n  for (var a in attr) {\n    if (!/fill|stroke|opacity|transform/.test(a)) { delete attr[a] }\n  }\r\n\r\n  return attr\r\n}\r\n\r\nconst getParserPath = (pathArray) => {\r\n  const path = parser().path\r\n  path.setAttribute('d', pathArray.toString())\r\n  return path\r\n}\r\n\r\nconst pathLength = (pathArray) => {\r\n  return getParserPath(pathArray).getTotalLength()\r\n}\r\n\r\nextend(PathArray, {\r\n  // Convert path to poly\r\n  toPoly (sample = '1%') {\r\n    let points = []\r\n    let length = 0\r\n    let x = 0\r\n    let y = 0\r\n\r\n    // parse sample value\r\n    sample = new SVGNumber(sample)\r\n\r\n    // get total length\r\n    const total = pathLength(this)\r\n\r\n    let distance\r\n\r\n    // calculate sample distance\r\n    if (sample.unit === '%') {\r\n      // sample distance in %\r\n      distance = total * sample.value\r\n    } else if (sample.unit === 'px') {\r\n      // fixed sample distance in px\r\n      distance = sample.value\r\n    } else {\r\n      // specific number of samples\r\n      distance = total / sample.value\r\n    }\r\n\r\n    // prepare arrays\r\n    const segmentsQueue = this.slice()\r\n\r\n    // prepare helpers functions\r\n    const addPoint = function (px, py) {\r\n      // get last point\r\n      const lastPoint = points[points.length - 1]\r\n\r\n      // when the last point doesn't equal the current point add the current point\r\n      if (!lastPoint || px !== lastPoint[0] || py !== lastPoint[1]) {\r\n        points.push([px, py])\r\n        x = px\r\n        y = py\r\n      }\r\n    }\r\n\r\n    const addSegmentPoint = function (segment) {\r\n      // don't bother processing path ends\r\n      if (segment[0] === 'Z') return\r\n\r\n      // map segment to x and y\r\n      switch (segment[0]) {\r\n      case 'M':\r\n      case 'L':\r\n      case 'T':\r\n        x = segment[1]\r\n        y = segment[2]\r\n        break\r\n      case 'H':\r\n        x = segment[1]\r\n        break\r\n      case 'V':\r\n        y = segment[1]\r\n        break\r\n      case 'C':\r\n        x = segment[5]\r\n        y = segment[6]\r\n        break\r\n      case 'S':\r\n      case 'Q':\r\n        x = segment[3]\r\n        y = segment[4]\r\n        break\r\n      case 'A':\r\n        x = segment[6]\r\n        y = segment[7]\r\n        break\r\n      }\r\n\r\n      // add point\r\n      addPoint(x, y)\r\n    }\r\n\r\n    let lastSegment\r\n    let segmentIndex = 0\r\n    let subPath = this.slice(0, segmentIndex + 1)\r\n    let subPathLength = pathLength(subPath)\r\n\r\n    // sample through path\r\n    while (length < total) {\r\n\r\n      // get segment index\r\n      while (subPathLength < length) {\r\n        ++segmentIndex\r\n        subPath = this.slice(0, segmentIndex + 1)\r\n        subPathLength = pathLength(subPath)\r\n      }\r\n\r\n      // get segment\r\n      const segment = this[segmentIndex]\r\n\r\n      // new segment?\r\n      if (segment !== lastSegment) {\r\n        // add the segment we just left\r\n        if (lastSegment !== undefined) {\r\n          addSegmentPoint(lastSegment)\r\n        }\r\n\r\n        // add all segments which we just skipped\r\n        while (segmentsQueue.length && segmentsQueue[0] !== segment) {\r\n          addSegmentPoint(segmentsQueue.shift())\r\n        }\r\n\r\n        lastSegment = segment\r\n      }\r\n\r\n      // add points in between when curving\r\n      switch (segment[0]) {\r\n      case 'C':\r\n      case 'T':\r\n      case 'S':\r\n      case 'Q':\r\n      case 'A':\r\n        const point = getParserPath(this).getPointAtLength(length)\r\n        addPoint(point.x, point.y)\r\n        break\r\n      }\r\n\r\n      // increment by sample value\r\n      length += distance\r\n    }\r\n\r\n    let i = 0\r\n    let il = segmentsQueue.length\r\n    // add remaining segments we didn't pass while sampling\r\n    for (; i < il; ++i) {\r\n      addSegmentPoint(segmentsQueue[i])\r\n    }\r\n\r\n    // send out as point array\r\n    return new PointArray(points)\r\n  }\r\n\r\n})\r\n\r\nextend(Path, {\r\n  // Convert path to poly\r\n  toPoly (sample = '1%', replace = true) {\r\n    // define type\r\n    const Poly = /z\\s*$/i.test(this.attr('d')) ? Polygon : Polyline\r\n\r\n    const pointArray = this.array().toPoly(sample)\r\n\r\n    // create poly\r\n    const poly = new Poly().plot(pointArray)\r\n      .attr(normaliseAttributes(this.attr()))\r\n\r\n    // insert poly\r\n    if (replace) {\r\n      this.replace(poly)\r\n    }\r\n\r\n    return poly\r\n  }\r\n\r\n})\r\n"],"names":["normaliseAttributes","attr","a","test","getParserPath","pathArray","path","parser","setAttribute","toString","pathLength","getTotalLength","extend","PathArray","toPoly","sample","points","length","x","y","SVGNumber","total","distance","unit","value","segmentsQueue","slice","addPoint","px","py","lastPoint","push","addSegmentPoint","segment","lastSegment","segmentIndex","subPath","subPathLength","undefined","shift","point","getPointAtLength","i","il","PointArray","Path","replace","Poly","Polygon","Polyline","pointArray","array","poly","plot"],"mappings":"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"}