{"version":3,"file":"svg.topath.node.js","sources":["../src/svg.topath.js"],"sourcesContent":["\r\nimport { Path, Shape, extend } from '@svgdotjs/svg.js'\n\n// Normalise attributes\nconst normaliseAttributes = (attr) => {\n  for (const a in attr) {\n    if (!/fill|stroke|opacity|transform/.test(a)) { delete attr[a] }\n  }\n\n  return attr\n}\n\nextend(Shape, {\r\n  // Convert element to path\r\n  toPath (replace = true) {\r\n    var d\r\n\r\n    switch (this.type) {\r\n    case 'rect': {\r\n      let {\r\n        width: w,\r\n        height: h,\r\n        rx,\r\n        ry,\r\n        x,\r\n        y\r\n      } = this.attr(['width', 'height', 'rx', 'ry', 'x', 'y'])\r\n\r\n      // normalise radius values, just like the original does it (or should do)\r\n      if (rx < 0) rx = 0\r\n      if (ry < 0) ry = 0\r\n      rx = rx || ry\r\n      ry = ry || rx\r\n      if (rx > w / 2) rx = w / 2\r\n      if (ry > h / 2) ry = h / 2\r\n\r\n      if (rx && ry) {\r\n        // if there are round corners\r\n\r\n        d = [\r\n          ['M', rx + x, y],\r\n          ['h', w - 2 * rx],\r\n          ['a', rx, ry, 0, 0, 1, rx, ry],\r\n          ['v', h - 2 * ry],\r\n          ['a', rx, ry, 0, 0, 1, -rx, ry],\r\n          ['h', -w + 2 * rx],\r\n          ['a', rx, ry, 0, 0, 1, -rx, -ry],\r\n          ['v', -h + 2 * ry],\r\n          ['a', rx, ry, 0, 0, 1, rx, -ry],\r\n          ['z']\r\n        ]\r\n      } else {\r\n        // no round corners, no need to draw arcs\r\n        d = [\r\n          ['M', x, y],\r\n          ['h', w],\r\n          ['v', h],\r\n          ['h', -w],\r\n          ['v', -h],\r\n          ['z']\r\n        ]\r\n      }\r\n\r\n      break\r\n    }\r\n    case 'circle':\r\n    case 'ellipse': {\r\n      let rx = this.rx()\r\n      let ry = this.ry()\r\n      let { cx, cy } = this.attr(['cx', 'cy'])\r\n\r\n      d = [\r\n        ['M', cx - rx, cy],\r\n        ['A', rx, ry, 0, 0, 0, cx + rx, cy],\r\n        ['A', rx, ry, 0, 0, 0, cx - rx, cy],\r\n        ['z']\r\n      ]\r\n\r\n      break\r\n    }\r\n    case 'polygon':\r\n    case 'polyline':\r\n    case 'line':\r\n\r\n      d = this.array().map(function (arr) {\r\n        return ['L'].concat(arr)\r\n      })\r\n\r\n      d[0][0] = 'M'\r\n\r\n      if (this.type === 'polygon') { d.push('Z') }\r\n\r\n      break\r\n    case 'path':\r\n      d = this.array()\r\n      break\r\n    default:\r\n      throw new Error('SVG toPath got unsupported type ' + this.type, this)\r\n    }\r\n\r\n    const path = new Path()\r\n      .plot(d)\r\n      .attr(normaliseAttributes(this.attr()))\r\n\r\n    if (replace) {\r\n      this.replace(path)\r\n    }\r\n\r\n    return path\r\n  }\r\n\r\n})\r\n"],"names":["normaliseAttributes","attr","a","test","extend","Shape","toPath","replace","d","type","width","w","height","h","rx","ry","x","y","cx","cy","array","map","arr","concat","push","Error","path","Path","plot"],"mappings":"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"}